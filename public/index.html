<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Viyu</title>
  <meta name="author" content="Viyu">

  
  

  <link rel="alternate" href="/atom.xml" title="Viyu" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
</head>

<body>
  <header id="header" class="inner"><nav>
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
</nav></header>
  <div id="content" class="inner">
  <article class="post">
  
  <header>
    
  
    <h1 class="title"><a href="/2013/11/20/2013-11-20-The Adapter of ListView/">The Adapter of ListView: Just adapt data to view, don’t do anything else</a></h1>
  

    <time datetime="2013-11-20T00:00:00.000Z">
  <span class="day">20</span><span class="month">Nov</span>
</time>
  </header>
  <div class="entry-content">
    
      <p>The design of SimpleAdapter is not good in my opinion.</p>
<p>An adapter should just adapter the data to view, not care to inflate xml to create Layout View, hold the member Views of the layout view, and, fill the datas to each member View one by one. SimpleAdapter does these things all together. It is high coupling design.</p>
<p>The solution is a ItemViewHolder class, which inflate and hold the layout view and its member views, and parse datas to fill them  to member views one by one. And the most cool is, it’s layout view of ItemViewHolder set “this” as its tag. So that you can get the ItemViewHolder instance of the convertView in getView(…, View convertView, …) function.</p>
<p>See below code snippets.</p>
<p>In Adapter, passed in a List as data list.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>List<span class="tag">&lt;<span class="title">Data</span>&gt;</span> dataList;  
</pre></td></tr></table></figure>


<p>and override getView() like this:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="code"><pre>@Override  
public View getView(int position, View convertView, ViewGroup parent) {  
    ItemViewHolder item = null<span class="comment">;  </span>
  
    if(convertView == null) {  
        item = new ItemViewHolder(context)<span class="comment">;  </span>
        convertView = item<span class="preprocessor">.getLayoutView</span>()<span class="comment">;  </span>
    } else {  
        item = (ItemViewHolder)convertView<span class="preprocessor">.getTag</span>()<span class="comment">;  </span>
    }  
  
    item<span class="preprocessor">.setItemData</span>(dataList<span class="preprocessor">.get</span>(position))<span class="comment">;  </span>
  
    return convertView<span class="comment">;  </span>
}  
</pre></td></tr></table></figure>


<p>ItemViewHolder is the views holder of the convertView.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="code"><pre><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="id">ItemViewHolder</span> {</span>  
  
    <span class="comment">//The layout View of the item of the ListView.  </span>
    <span class="keyword">private</span> View layoutView = null;  
    <span class="comment">//The member Views to display data.  </span>
    <span class="keyword">private</span> TextView textView = null;  
    <span class="keyword">private</span> ImageView imageView = null;  
    … …  
  
    <span class="keyword">public</span> ItemViewHolder (Context context) {  
        <span class="keyword">super</span>(context);  
  
         initUI();  
    }  
  
    <span class="keyword">public</span> View getLayoutView() {  
        <span class="keyword">return</span> layoutView;  
    }  
  
    <span class="keyword">public</span> <span class="keyword">void</span> setItemData(Data data) {  
        textView<span class="variable">.setText</span>(data<span class="variable">.getText</span>());  
        imageView<span class="variable">.setImage</span>(data<span class="variable">.getImage</span>());  
        … …  
    }  
  
    <span class="keyword">private</span> <span class="keyword">void</span> initUI() {  
         LayoutInflater inflater = LayoutInflater<span class="variable">.from</span>(mContext);  
         layoutView = inflater<span class="variable">.inflate</span>(R<span class="variable">.layout</span><span class="variable">.item_view_layout</span>, null);  
        <span class="comment">//  </span>
        textView = (TextView) layoutView<span class="variable">.findViewById</span>(R<span class="variable">.id</span><span class="variable">.textview</span>);  
        imageView = (ImageView)layoutView<span class="variable">.findViewById</span>(R<span class="variable">.id</span><span class="variable">.imageview</span>);  
       <span class="comment">//This is the most important code.  </span>
       layoutView<span class="variable">.setTag</span>(<span class="keyword">this</span>);  
    }  
}  
</pre></td></tr></table></figure>



    
    
    <footer class="meta">
      
      
  <div class="tags">
<a href="/tags/Android/">Android</a></div>

      
    </footer>
    
  </div>
  
</article>

  <article class="post">
  
  <header>
    
  
    <h1 class="title"><a href="/2013/11/16/2013-11-16-shape plus selector/">Shape + Selector: Make a Shape as one item of the Selector</a></h1>
  

    <time datetime="2013-11-16T00:00:00.000Z">
  <span class="day">16</span><span class="month">Nov</span>
</time>
  </header>
  <div class="entry-content">
    
      <p>Generally, I use a selector to select pictures or colors to render the normal and the pressed background for View. </p>
<p>And use a Shape to draw a fixed background with border, round, gradient and other UI effect for View.</p>
<p>What if you wanna use them both for one View?</p>
<p>Make a Shape as one item of the Selector.</p>
<p>Selector selects background from Shape list.</p>
<p>Below is a sample.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="code"><pre><span class="pi">&lt;?xml version=”1.0″ encoding=”UTF-8″?&gt;</span>  
<span class="tag">&lt;<span class="title">selector</span> <span class="attribute">xmlns:android</span>=<span class="value">”http:</span>//<span class="attribute">schemas.android.com</span>/<span class="attribute">apk</span>/<span class="attribute">res</span>/<span class="attribute">android</span>”&gt;</span>  
    <span class="tag">&lt;<span class="title">item</span> <span class="attribute">android:state_pressed</span>=<span class="value">”true”</span>&gt;</span>  
            <span class="tag">&lt;<span class="title">shape</span> <span class="attribute">android:shape</span>=<span class="value">”rectangle”</span>&gt;</span>  
                  <span class="tag">&lt;<span class="title">solid</span> <span class="attribute">android:color</span>=<span class="value">”@color</span>/<span class="attribute">background_pressed</span>” /&gt;</span>  
                  <span class="tag">&lt;<span class="title">stroke</span> <span class="attribute">android:width</span>=<span class="value">”@dimen</span>/<span class="attribute">gap_2</span>″ <span class="attribute">android:color</span>=<span class="value">”@color</span>/<span class="attribute">linecolor</span>” /&gt;</span>  
                  <span class="tag">&lt;<span class="title">padding</span> <span class="attribute">android:bottom</span>=<span class="value">”@dimen</span>/<span class="attribute">gap_2</span>″ <span class="attribute">android:left</span>=<span class="value">”@dimen</span>/<span class="attribute">gap_2</span>″                                     
                  <span class="attribute">android:right</span>=<span class="value">”@dimen</span>/<span class="attribute">gap_2</span>″ <span class="attribute">android:top</span>=<span class="value">”@dimen</span>/<span class="attribute">gap_2</span>″ /&gt;</span>  
            <span class="tag">&lt;/<span class="title">shape</span>&gt;</span>  
     <span class="tag">&lt;/<span class="title">item</span>&gt;</span>  
  
     <span class="tag">&lt;<span class="title">item</span>&gt;</span>  
         <span class="tag">&lt;<span class="title">shape</span> <span class="attribute">android:shape</span>=<span class="value">”rectangle”</span>&gt;</span>  
              <span class="tag">&lt;<span class="title">solid</span> <span class="attribute">android:color</span>=<span class="value">”@color</span>/<span class="attribute">background_normal</span>” /&gt;</span>  
              <span class="tag">&lt;<span class="title">stroke</span> <span class="attribute">android:width</span>=<span class="value">”@dimen</span>/<span class="attribute">gap_2</span>″ <span class="attribute">android:color</span>=<span class="value">”@color</span>/<span class="attribute">linecolor</span>” /&gt;</span>  
              <span class="tag">&lt;<span class="title">padding</span> <span class="attribute">android:bottom</span>=<span class="value">”@dimen</span>/<span class="attribute">gap_2</span>″ <span class="attribute">android:left</span>=<span class="value">”@dimen</span>/<span class="attribute">gap_2</span>″                                          
              <span class="attribute">android:right</span>=<span class="value">”@dimen</span>/<span class="attribute">gap_2</span>″ <span class="attribute">android:top</span>=<span class="value">”@dimen</span>/<span class="attribute">gap_2</span>″ /&gt;</span>  
         <span class="tag">&lt;/<span class="title">shape</span>&gt;</span>  
     <span class="tag">&lt;/<span class="title">item</span>&gt;</span>  
<span class="tag">&lt;/<span class="title">selector</span>&gt;</span>  
</pre></td></tr></table></figure>



    
    
    <footer class="meta">
      
      
  <div class="tags">
<a href="/tags/Android/">Android</a></div>

      
    </footer>
    
  </div>
  
</article>

  <article class="post">
  
  <header>
    
  
    <h1 class="title"><a href="/2013/10/18/2013-10-18-units issue/">Units Problem: How to read text size as custom attr from xml and set it to TextView in java code</a></h1>
  

    <time datetime="2013-10-18T00:00:00.000Z">
  <span class="day">18</span><span class="month">Oct</span>
</time>
  </header>
  <div class="entry-content">
    
      <p>Here is this topic’s background:</p>
<p>I defined a custom View which extends FrameLayout and contains a TextView, calledMyView here. And I defined custom attribute “myviewtextsize” in attrs.xml for MyView so that clients can set different text size in layout xml for the TextView of MyView.</p>
<p>So far, clients code can set text size like this:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">MyView</span>  
     <span class="attribute">android:</span>…  
     …
     <span class="attribute">my:myviewtextsize</span>=<span class="value">”@dimen</span>/<span class="attribute">textsize_24</span>″  
     …  
/&gt;</span> 
</pre></td></tr></table></figure>


<p>The problem is: how to read the client’s text size number and set it to the TextVew of MyView?</p>
<p>In MyView.java,</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="title">float</span> textSize = <span class="typedef">typedArray.getDimension<span class="container">(<span class="type">R</span>.<span class="type">MyView_myviewtextsize</span>, -1)</span>;  </span>
  
<span class="title">this</span>.textView.setTextSize(textSize).  
</pre></td></tr></table></figure>


<p>Above code goes wrong. The text size is bigger than it’s supposed to.</p>
<p>Why? It is mixed units problem.</p>
<p>The default method setTextSize(float) assumes you’re inputting sp units (scaled pixels), while the typedArray.getDimension() method returns an exact pixel size.</p>
<p>It can be fixed this by using the alternate <b>setTextSize(TypedValue, float)</b>, like below:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="keyword">this</span><span class="variable">.textView</span><span class="variable">.setTextSize</span>(TypedValue<span class="variable">.COMPLEX_UNIT_PX</span>, size);  
</pre></td></tr></table></figure>


<p>This will make sure you’re working with the same units.</p>

    
    
    <footer class="meta">
      
      
  <div class="tags">
<a href="/tags/Android/">Android</a></div>

      
    </footer>
    
  </div>
  
</article>


<nav id="pagenavi">
  
  
  <div class="clearfix"></div>
</nav></div>
  <footer id="footer" class="inner"><div class="social alignright">
  
  
  
  
  <a class="rss" href="/atom.xml" title="RSS">RSS</a>
</div>
<p>
  
  &copy; 2013 Viyu
  
</p>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<div id="phasebeam">
  <canvas></canvas>
  <canvas></canvas>
  <canvas></canvas>
</div>
<script src="/js/phasebeam.js"></script>
</body>
</html>